cmake_minimum_required(VERSION 3.11 FATAL_ERROR)

if(NOT CMAKE_INSTALL_PREFIX)
set(CMAKE_INSTALL_PREFIX "${CMAKE_SOURCE_DIR}" CACHE PATH "Default installation" FORCE)
endif()

project(ndmspc VERSION 0.0.0 DESCRIPTION "NDMSPC")
set(PROJECT_VERSION_RELEASE 0.1.rc0)

include(cmake/cmake_base.cmake)
find_package(Root REQUIRED)
find_package(nlohmann_json REQUIRED)
include(ROOTMacros)

include_directories(${PROJECT_SOURCE_DIR}/Utils)
add_subdirectory(Core)
add_subdirectory(Event)
add_subdirectory(Ndh)
add_subdirectory(src)
add_subdirectory(doc)

# profile.d
configure_file (
  "${PROJECT_SOURCE_DIR}/cmake/${CMAKE_PROJECT_NAME}.sh.profile.d.in"
  "${PROJECT_BINARY_DIR}/etc/profile.d/${CMAKE_PROJECT_NAME}.sh"
)


if (CMAKE_INSTALL_PREFIX STREQUAL "/usr")
INSTALL(DIRECTORY macros DESTINATION ${CMAKE_INSTALL_PREFIX}/share/${PROJECT_NAME} USE_SOURCE_PERMISSIONS)
INSTALL(FILES ${PROJECT_BINARY_DIR}/etc/profile.d/${CMAKE_PROJECT_NAME}.sh DESTINATION /etc/profile.d/)
else ()
INSTALL(DIRECTORY macros DESTINATION ${CMAKE_INSTALL_PREFIX} USE_SOURCE_PERMISSIONS)
endif ()
INSTALL(FILES scripts/ndmspc PERMISSIONS 
OWNER_EXECUTE OWNER_WRITE OWNER_READ
GROUP_EXECUTE GROUP_READ 
WORLD_EXECUTE WORLD_READ 
DESTINATION ${CMAKE_INSTALL_PREFIX}/bin)
INSTALL(FILES scripts/ndmspc-run.sh PERMISSIONS 
OWNER_EXECUTE OWNER_WRITE OWNER_READ
GROUP_EXECUTE GROUP_READ 
WORLD_EXECUTE WORLD_READ 
DESTINATION ${CMAKE_INSTALL_PREFIX}/bin)
