%global debug_package %{nil}
%global source_date_epoch_from_changelog %{nil}

Name:       @PROJECT_NAME@
Version:	@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@.@PROJECT_VERSION_PATCH@
Release:	@PROJECT_VERSION_RELEASE@%{?dist}
Summary:	@PROJECT_DESCRIPTION@
Group:		System Environment/Libraries
License:	LGPL v3+
Source0:    %{name}-%{version}.tar.gz

BuildRequires: systemd-rpm-macros
BuildRequires: gcc-c++, cmake
BuildRequires: doxygen
BuildRequires: openssl-devel, libcurl-devel, libuv-devel, libwebsockets-devel
BuildRequires: opentelemetry-cpp-devel, json-devel, protobuf-devel
# BuildRequires: parquet-libs-devel
BuildRequires: root, root-net-http, root-net-httpsniff
Requires:      root, root-netx, root-net-http, root-net-httpsniff, xrootd-client

%description
@PROJECT_DESCRIPTION@

%package doc
Summary:  Documentation
Group:    Documentation
Requires: %{name} = %{version}-%{release}, pkgconfig

%description doc
This package contains @PROJECT_NAME@ documentation.


%package jupyroot
Summary:  Jupyroot bindings for @PROJECT_NAME@
Group:    Additional Packages
Requires: %{name} = %{version}-%{release}, pkgconfig
Requires: python3-jupyroot

%description jupyroot
This package contains Jupyroot bindings for @PROJECT_NAME@.

%prep
%setup -q

%build
mkdir build
cd build
cmake ../ -DWITH_PARQUET=OFF -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DBUILD_DOCUMENTATION=on
make %{?_smp_mflags}
cd ../

%install
rm -rf %{buildroot}
cd build
make install DESTDIR=%{buildroot}

%post
%systemd_post ndmspc-http@*.service

%preun
%systemd_preun ndmspc-http@*.service

%postun
%systemd_postun ndmspc-http@*.service

%preun jupyroot
%systemd_preun ndmspc-notebook@*.service

%postun jupyroot
%systemd_postun ndmspc-notebook@*.service

%post jupyroot
%systemd_post ndmspc-notebook@*.service

%files
%{_bindir}/*
%{_libdir}/*
%{_datadir}/%{name}/*
%{_sysconfdir}/*
%{_includedir}/*
%{_unitdir}/ndmspc-http@.service

%files doc
%doc /usr/share/doc/%{name}/

%files jupyroot
%{_unitdir}/ndmspc-notebook@.service

%changelog
